local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local Library = {}
Library.__index = Library

Library.Theme = {
	Background = Color3.fromRGB(25, 25, 25),
	Accent = Color3.fromRGB(0, 120, 255),
	Text = Color3.fromRGB(255, 255, 255),
	TitleBar = Color3.fromRGB(10, 60, 130) -- distinct darker blue for top bar
}

function Library:CreateWindow(opts)
	local self = setmetatable({}, Library)

	local guiName = opts.Name or "ExecutorUI"

	for _, v in pairs(CoreGui:GetChildren()) do
		if v:IsA("ScreenGui") and v.Name == guiName then
			v:Destroy()
		end
	end

	local screenGui = Instance.new("ScreenGui", CoreGui)
	screenGui.Name = guiName
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.ResetOnSpawn = false

	local main = Instance.new("Frame")
	main.Size = UDim2.new(0, 500, 0, 400)
	main.Position = UDim2.new(0.5, -250, 0.5, -200)
	main.BackgroundColor3 = Library.Theme.Background
	main.Name = "Main"
	main.BorderSizePixel = 0
	main.BackgroundTransparency = 1
	main.Parent = screenGui

	-- Title Bar Frame for dragging & colored top
	local titleBar = Instance.new("Frame", main)
	titleBar.Size = UDim2.new(1, 0, 0, 40)
	titleBar.Position = UDim2.new(0, 0, 0, 0)
	titleBar.BackgroundColor3 = Library.Theme.TitleBar
	titleBar.BorderSizePixel = 0

	local title = Instance.new("TextLabel", titleBar)
	title.Size = UDim2.new(1, -40, 1, 0)
	title.Position = UDim2.new(0, 0, 0, 0)
	title.Text = opts.Name or "Executor Hub"
	title.BackgroundTransparency = 1
	title.TextColor3 = Library.Theme.Text
	title.Font = Enum.Font.GothamBold
	title.TextScaled = true
	title.TextTransparency = 1
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Position = UDim2.new(0, 10, 0, 0)

	local closeBtn = Instance.new("TextButton", titleBar)
	closeBtn.Size = UDim2.new(0, 40, 1, 0)
	closeBtn.Position = UDim2.new(1, -40, 0, 0)
	closeBtn.Text = "X"
	closeBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	closeBtn.TextColor3 = Color3.new(1, 0, 0)
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.TextScaled = true
	closeBtn.BackgroundTransparency = 1
	closeBtn.TextTransparency = 1

	-- Drag Logic on titleBar only
	local dragging, dragInput, dragStart, startPos

	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = main.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)

	-- Fade In
	TweenService:Create(main, TweenInfo.new(0.5), {BackgroundTransparency = 0}):Play()
	TweenService:Create(title, TweenInfo.new(0.5), {TextTransparency = 0}):Play()
	TweenService:Create(closeBtn, TweenInfo.new(0.5), {
		TextTransparency = 0,
		BackgroundTransparency = 0.1
	}):Play()

	local visible = true

	closeBtn.MouseButton1Click:Connect(function()
		main.Visible = false
		visible = false
	end)

	-- Key toggle with K
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if not gameProcessed and input.KeyCode == Enum.KeyCode.K then
			visible = not visible
			main.Visible = visible
		end
	end)

	self.Main = main
	self.Tabs = {}

	function self:CreateTab(tabName)
		local tab = Instance.new("Frame", main)
		tab.Name = tabName
		tab.BackgroundTransparency = 1
		tab.Size = UDim2.new(1, 0, 1, -40)
		tab.Position = UDim2.new(0, 0, 0, 40)

		local layout = Instance.new("UIListLayout", tab)
		layout.Padding = UDim.new(0, 8)
		layout.SortOrder = Enum.SortOrder.LayoutOrder

		local tabObj = {}

		function tabObj:AddButton(text, callback)
			local btn = Instance.new("TextButton", tab)
			btn.Size = UDim2.new(0, 200, 0, 40)
			btn.Text = text
			btn.BackgroundColor3 = Library.Theme.Accent
			btn.TextColor3 = Library.Theme.Text
			btn.Font = Enum.Font.Gotham
			btn.TextScaled = true
			btn.BackgroundTransparency = 1
			btn.TextTransparency = 1

			TweenService:Create(btn, TweenInfo.new(0.4), {
				BackgroundTransparency = 0,
				TextTransparency = 0
			}):Play()

			btn.MouseButton1Click:Connect(callback)
		end

		table.insert(self.Tabs, tab)
		return tabObj
	end

	return self
end

return Library
